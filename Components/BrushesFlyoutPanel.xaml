<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:LunaDraw.Logic.ViewModels"
             xmlns:models="clr-namespace:LunaDraw.Logic.Models"
             xmlns:components="clr-namespace:LunaDraw.Components"
             x:Class="LunaDraw.Components.BrushesFlyoutPanel"
             x:DataType="viewModels:ToolbarViewModel">
  <Border Background="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray800}}"
          Padding="12"
          StrokeShape="RoundRectangle"
          Stroke="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray600}}"
          StrokeThickness="1">
    <StackLayout Spacing="10">
      <Label Text="Choose a Brush"
             FontAttributes="Bold"
             FontSize="16"
             HorizontalTextAlignment="Center"/>

      <BoxView HeightRequest="1"
               Color="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray600}}"
               Margin="0,5"/>
               
      <ScrollView Orientation="Horizontal" HorizontalScrollBarVisibility="Never">
          <StackLayout BindableLayout.ItemsSource="{Binding AvailableBrushShapes}"
                       Orientation="Horizontal"
                       Spacing="10"
                       HorizontalOptions="Center">
            <BindableLayout.ItemTemplate>
              <DataTemplate x:DataType="models:BrushShape">
                <StackLayout>
                    <Border StrokeShape="RoundRectangle 10"
                            StrokeThickness="1"
                            Stroke="Gray"
                            WidthRequest="60"
                            HeightRequest="60"
                            Padding="0">
                         <Border.GestureRecognizers>
                             <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:ToolbarViewModel}}, Path=SelectBrushShapeCommand}"
                                                   CommandParameter="{Binding .}"/>
                         </Border.GestureRecognizers>
                         <components:BrushPreviewControl BrushShape="{Binding .}"
                                                         StrokeColor="{Binding Source={RelativeSource AncestorType={x:Type viewModels:ToolbarViewModel}}, Path=StrokeColor}"
                                                         Color="{AppThemeBinding Light=Black, Dark=White}"
                                                         HorizontalOptions="Fill"
                                                         VerticalOptions="Fill"/>
                    </Border>
                    <Label Text="{Binding Name}"
                           FontSize="12"
                           HorizontalTextAlignment="Center"
                           LineBreakMode="TailTruncation"/>
                </StackLayout>
              </DataTemplate>
            </BindableLayout.ItemTemplate>
          </StackLayout>
      </ScrollView>

      <BoxView HeightRequest="1"
               Color="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray600}}"
               Margin="0,5"/>

      <StackLayout Orientation="Horizontal" Spacing="10">
          <Label Text="Glow Effect"
                 VerticalOptions="Center"
                 FontAttributes="Bold"/>
          <Switch x:Name="GlowSwitch"
                  Toggled="OnGlowSwitchToggled"
                  HorizontalOptions="EndAndExpand"/>
      </StackLayout>

      <Label Text="Glow Radius"
             FontAttributes="Bold"/>
      <Slider x:Name="GlowRadiusSlider"
              Minimum="1"
              Maximum="50"
              ValueChanged="OnGlowRadiusChanged"/>

      <Label Text="Glow Color"
             FontAttributes="Bold"/>
      <StackLayout x:Name="GlowColorContainer" Orientation="Horizontal" Spacing="10" HorizontalOptions="Center">
          <!-- Preset Colors -->
          <Border Stroke="Gray" StrokeShape="RoundRectangle 15" StrokeThickness="1" HeightRequest="30" WidthRequest="30">
               <BoxView Color="#FFFF00" HorizontalOptions="Fill" VerticalOptions="Fill">
                   <BoxView.GestureRecognizers>
                       <TapGestureRecognizer Tapped="OnGlowColorTapped" CommandParameter="#FFFF00"/>
                   </BoxView.GestureRecognizers>
               </BoxView>
          </Border>
          <Border Stroke="Gray" StrokeShape="RoundRectangle 15" StrokeThickness="1" HeightRequest="30" WidthRequest="30">
               <BoxView Color="#00FFFF" HorizontalOptions="Fill" VerticalOptions="Fill">
                   <BoxView.GestureRecognizers>
                       <TapGestureRecognizer Tapped="OnGlowColorTapped" CommandParameter="#00FFFF"/>
                   </BoxView.GestureRecognizers>
               </BoxView>
          </Border>
          <Border Stroke="Gray" StrokeShape="RoundRectangle 15" StrokeThickness="1" HeightRequest="30" WidthRequest="30">
               <BoxView Color="#FF00FF" HorizontalOptions="Fill" VerticalOptions="Fill">
                   <BoxView.GestureRecognizers>
                       <TapGestureRecognizer Tapped="OnGlowColorTapped" CommandParameter="#FF00FF"/>
                   </BoxView.GestureRecognizers>
               </BoxView>
          </Border>
           <Border Stroke="Gray" StrokeShape="RoundRectangle 15" StrokeThickness="1" HeightRequest="30" WidthRequest="30">
               <BoxView Color="#00FF00" HorizontalOptions="Fill" VerticalOptions="Fill">
                   <BoxView.GestureRecognizers>
                       <TapGestureRecognizer Tapped="OnGlowColorTapped" CommandParameter="#00FF00"/>
                   </BoxView.GestureRecognizers>
               </BoxView>
          </Border>
          <Border Stroke="Gray" StrokeShape="RoundRectangle 15" StrokeThickness="1" HeightRequest="30" WidthRequest="30">
               <BoxView Color="#FFFFFF" HorizontalOptions="Fill" VerticalOptions="Fill">
                   <BoxView.GestureRecognizers>
                       <TapGestureRecognizer Tapped="OnGlowColorTapped" CommandParameter="#FFFFFF"/>
                   </BoxView.GestureRecognizers>
               </BoxView>
          </Border>
      </StackLayout>
    </StackLayout>
  </Border>
</ContentView>
