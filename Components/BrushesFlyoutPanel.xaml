<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:LunaDraw.Logic.ViewModels"
             xmlns:models="clr-namespace:LunaDraw.Logic.Models"
             xmlns:components="clr-namespace:LunaDraw.Components"
             x:Class="LunaDraw.Components.BrushesFlyoutPanel"
             x:DataType="viewModels:ToolbarViewModel"
             x:Name="Root">
  <Border Background="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray800}}"
          Padding="12"
          StrokeShape="RoundRectangle"
          Stroke="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray600}}"
          StrokeThickness="1"
          MaximumWidthRequest="400">
    <StackLayout Spacing="10">
      <Label Text="Choose a Brush"
             FontAttributes="Bold"
             FontSize="16"
             HorizontalTextAlignment="Center"/>

      <BoxView HeightRequest="1"
               Color="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray600}}"
               Margin="0,5"/>
               
      <CollectionView ItemsSource="{Binding AvailableBrushShapes}"
                      HeightRequest="420"
                      HorizontalOptions="Fill"
                      SelectionMode="None">
        <CollectionView.ItemsLayout>
          <GridItemsLayout Orientation="Vertical"
                           Span="4"
                           VerticalItemSpacing="10"
                           HorizontalItemSpacing="10" />
        </CollectionView.ItemsLayout>
        <CollectionView.ItemTemplate>
          <DataTemplate x:DataType="models:BrushShape">
            <StackLayout HorizontalOptions="Center">
              <Border StrokeShape="RoundRectangle 10"
                      StrokeThickness="1"
                      Stroke="Gray"
                      WidthRequest="60"
                      HeightRequest="60"
                      Padding="4"
                      Margin="1">
                <Border.GestureRecognizers>
                  <TapGestureRecognizer Command="{Binding Source={x:Reference Root}, Path=ViewModel.SelectBrushShapeCommand, x:DataType=components:BrushesFlyoutPanel}"
                                        CommandParameter="{Binding .}" />
                </Border.GestureRecognizers>
                <components:BrushPreviewControl BrushShape="{Binding .}"
                                                StrokeColor="{Binding Source={x:Reference Root}, Path=ViewModel.StrokeColor, x:DataType=components:BrushesFlyoutPanel}"
                                                FillColor="{Binding Source={x:Reference Root}, Path=ViewModel.FillColor, x:DataType=components:BrushesFlyoutPanel}"
                                                IsGlowEnabled="{Binding Source={x:Reference Root}, Path=ViewModel.IsGlowEnabled, x:DataType=components:BrushesFlyoutPanel}"
                                                GlowColor="{Binding Source={x:Reference Root}, Path=ViewModel.GlowColor, x:DataType=components:BrushesFlyoutPanel}"
                                                GlowRadius="{Binding Source={x:Reference Root}, Path=ViewModel.GlowRadius, x:DataType=components:BrushesFlyoutPanel}"
                                                Color="{AppThemeBinding Light=Black, Dark=White}"
                                                HorizontalOptions="Fill"
                                                VerticalOptions="Fill" />
              </Border>
              <Label Text="{Binding Name}"
                     FontSize="12"
                     HorizontalTextAlignment="Center"
                     LineBreakMode="TailTruncation" />
            </StackLayout>
          </DataTemplate>
        </CollectionView.ItemTemplate>
      </CollectionView>
    </StackLayout>
  </Border>
</ContentView>
