<?xml version="1.0" encoding="utf-8" ?>
<mct:Popup xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
           xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
           xmlns:mct="clr-namespace:CommunityToolkit.Maui.Views;assembly=CommunityToolkit.Maui"
           xmlns:viewmodels="clr-namespace:LunaDraw.Logic.ViewModels"
           xmlns:components="clr-namespace:LunaDraw.Logic.BurnCalcPort.Components"
           x:DataType="viewmodels:GalleryViewModel"
           x:Class="LunaDraw.Components.GalleryPopup"
           BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray900}}">
  <Grid RowDefinitions="Auto, *, Auto"
        Padding="10">
    <!-- Header -->
    <HorizontalStackLayout Grid.Row="0"
                           Spacing="10"
                           VerticalOptions="Center"
                           Padding="10,0">
      <Label Text="Gallery"
             Style="{StaticResource Headline}"
             VerticalOptions="Center"/>
      <Button Text="New Drawing"
              Command="{Binding NewDrawingCommand}"/>
    </HorizontalStackLayout>

    <!-- Loading Indicator -->
    <ActivityIndicator Grid.Row="1"
                       IsRunning="{Binding IsLoading}"
                       IsVisible="{Binding IsLoading}"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"
                       ZIndex="1"/>

    <!-- Gallery Content (CollectionView) -->
    <CollectionView Grid.Row="1"
                    x:Name="GalleryCollectionView"
                    ItemsSource="{Binding Drawings}"
                    IsVisible="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                    Scrolled="OnCollectionViewScrolled">
        <CollectionView.ItemsLayout>
            <GridItemsLayout x:Name="GalleryGridLayout" 
                             Orientation="Vertical" 
                             Span="3" 
                             HorizontalItemSpacing="10" 
                             VerticalItemSpacing="10"/>
        </CollectionView.ItemsLayout>
        <CollectionView.ItemTemplate>
            <DataTemplate>
                <components:GalleryItemViewCell />
            </DataTemplate>
        </CollectionView.ItemTemplate>
    </CollectionView>

    <!-- Footer for additional controls or info -->
    <Label Grid.Row="2"
           Text="Select a drawing or create a new one."
           HorizontalOptions="Center"
           VerticalOptions="End"/>
  </Grid>
</mct:Popup>